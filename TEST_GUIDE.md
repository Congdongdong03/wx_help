# 聊天图片功能测试指南

## 测试环境准备

### 1. 后端服务

后端服务已经在运行，测试聊天记录已创建完成：

- 对话 ID: `cmck3zxqu00018o5etfbkf708`
- 用户 A: Development User (openid: dev_openid_123)
- 用户 B: 测试用户 B (openid: test_user_456)
- 消息数量: 11 条（8 条文本 + 3 条图片）

### 2. 前端应用

确保前端应用正在运行：

```bash
cd src
npm run dev:weapp
```

## 测试步骤

### 第一步：查看现有聊天记录

1. 打开小程序
2. 进入消息页面
3. 点击"测试聊天帖子"的对话
4. 验证能看到以下内容：
   - 文本消息正常显示
   - 图片消息显示为 `[图片]` 预览
   - 3 张测试图片可以正常显示和预览

### 第二步：测试图片发送功能

1. 在聊天界面中，点击输入框旁边的 📷 按钮
2. 选择"从相册选择"或"拍照"
3. 选择一张图片
4. 观察以下流程：
   - 图片立即显示在聊天界面（乐观更新）
   - 显示"发送中..."提示
   - 图片上传完成后状态变为"已发送"

### 第三步：测试图片预览功能

1. 点击聊天中的任意图片
2. 验证图片可以全屏预览
3. 测试缩放、保存等功能

### 第四步：测试错误处理

1. 在网络较慢的情况下测试图片发送
2. 验证重试机制是否正常工作
3. 测试发送失败时的错误提示

## 测试数据详情

### 已创建的测试消息：

1. **文本消息**："你好！我想了解一下这个帖子" (1 小时前)
2. **文本消息**："你好！这个帖子还在有效期内，有什么问题吗？" (58 分钟前)
3. **文本消息**："我想看看具体的图片，能发给我吗？" (57 分钟前)
4. **图片消息**：蓝色测试图片 1 (55 分钟前)
5. **文本消息**："这是第一张图片，还有其他角度的" (53 分钟前)
6. **图片消息**：绿色测试图片 2 (52 分钟前)
7. **文本消息**："看起来不错！价格可以商量吗？" (50 分钟前)
8. **文本消息**："可以，我们可以面谈，你什么时候方便？" (10 分钟前)
9. **文本消息**："明天下午可以吗？" (5 分钟前)
10. **图片消息**：橙色位置图片 (2 分钟前)
11. **文本消息**："好的，明天下午 2 点在这个地方见面" (1 分钟前)

### 测试图片 URL：

- 测试图片 1: `https://via.placeholder.com/400x300/007AFF/FFFFFF?text=测试图片1`
- 测试图片 2: `https://via.placeholder.com/400x300/28A745/FFFFFF?text=测试图片2`
- 位置图片: `https://via.placeholder.com/400x300/FF6B35/FFFFFF?text=位置图片`

## 功能验证清单

### ✅ 基础功能

- [ ] 图片选择按钮显示正常
- [ ] 可以从相册选择图片
- [ ] 可以拍照
- [ ] 图片上传成功
- [ ] 图片发送成功
- [ ] 图片在聊天界面正常显示
- [ ] 图片可以点击预览

### ✅ 用户体验

- [ ] 乐观更新（立即显示）
- [ ] 发送状态提示
- [ ] 错误处理和重试
- [ ] 响应式布局

### ✅ 消息列表

- [ ] 图片消息显示 `[图片]` 预览
- [ ] 时间显示正确
- [ ] 未读消息计数正确

### ✅ WebSocket 功能

- [ ] 实时消息推送
- [ ] 消息类型正确传递
- [ ] 连接状态管理

## 常见问题排查

### 1. 图片无法选择

- 检查小程序权限设置
- 确认设备有相册和相机权限

### 2. 图片上传失败

- 检查网络连接
- 确认后端服务正常运行
- 查看控制台错误信息

### 3. 图片无法显示

- 检查图片 URL 是否可访问
- 确认图片格式支持（JPG、PNG、GIF）

### 4. WebSocket 连接失败

- 检查后端 WebSocket 服务
- 确认网络连接正常

## 测试完成标准

当您完成以下测试后，说明图片功能已经正常工作：

1. ✅ 能够成功选择并发送图片
2. ✅ 图片在聊天界面正常显示
3. ✅ 图片可以点击预览
4. ✅ 消息列表中图片消息显示正确
5. ✅ 错误处理机制正常工作
6. ✅ 实时消息推送正常

## 下一步优化建议

测试完成后，可以考虑以下优化：

1. **性能优化**：添加图片压缩功能
2. **功能扩展**：支持多图片发送
3. **用户体验**：添加发送进度条
4. **安全性**：添加图片格式和大小限制
5. **缓存优化**：实现图片缓存机制

---

**测试愉快！** 🎉
