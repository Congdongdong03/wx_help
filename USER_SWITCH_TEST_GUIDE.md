# 用户切换测试指南

## 测试环境准备

1. **后端服务器已启动** - 运行在 `http://localhost:3000`
2. **测试用户已创建**：
   - 用户 A: `dev_openid_123` (昵称: 用户 A)
   - 用户 B: `test_user_456` (昵称: 用户 B)

## 测试步骤

### 1. 进入聊天页面

- 打开小程序，进入任意聊天对话页面
- 页面右上角会显示用户切换按钮

### 2. 测试用户 A 发送消息

1. 确保当前是用户 A（默认）
2. 发送一条文本消息："Hello from User A"
3. 发送一张图片
4. 观察消息是否正确发送和显示

### 3. 切换到用户 B

1. 点击右上角的"用户 B"按钮
2. 观察：
   - 是否显示"已切换到用户 B"提示
   - 消息列表是否清空
   - 是否重新加载消息
   - 头像是否切换为绿色 B 头像

### 4. 测试用户 B 发送消息

1. 以用户 B 身份发送消息："Hello from User B"
2. 发送一张图片
3. 观察消息是否正确发送

### 5. 切换回用户 A

1. 点击右上角的"用户 A"按钮
2. 观察是否能看到之前用户 A 发送的消息

### 6. 测试消息接收

1. 在用户 A 发送消息后，切换到用户 B
2. 观察用户 B 是否能收到用户 A 的消息
3. 反之亦然

## 预期结果

### ✅ 成功表现

- 用户切换时显示成功提示
- WebSocket 连接正常，无"WebSocket is not connected"错误
- 消息能正常发送和接收
- 图片能正常上传和显示
- 消息状态正确显示（发送中、已发送、失败）
- 重试功能正常工作

### ❌ 问题表现

- 切换用户时出现连接错误
- 消息发送失败
- 图片上传失败
- 消息状态一直显示"发送中"

## 故障排除

### 如果出现 WebSocket 连接错误

1. 检查后端服务器是否正常运行
2. 检查网络连接
3. 查看浏览器控制台错误信息

### 如果消息发送失败

1. 检查 WebSocket 连接状态
2. 查看后端日志
3. 尝试重新连接

### 如果图片上传失败

1. 检查上传 API 是否正常
2. 检查图片大小和格式
3. 查看网络连接

## 测试数据

### 测试对话 ID

- 对话 ID: `test-conversation-123`
- 帖子 ID: `999`

### 测试用户信息

- 用户 A: `dev_openid_123` (蓝色头像)
- 用户 B: `test_user_456` (绿色头像)

## 日志查看

### 前端日志

- 打开浏览器开发者工具
- 查看 Console 标签页
- 关注 WebSocket 连接和消息发送日志

### 后端日志

- 查看服务器控制台输出
- 关注 WebSocket 连接和消息处理日志
